<!DOCTYPE html>
<html lang="en" data-theme="light">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Checkout - Jutta Pasal</title>
    <link rel="stylesheet" href="style.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <!-- Header -->
    <header class="header" id="header">
      <nav class="nav container">
        <a href="index.html" class="nav-logo">
          <span class="logo-icon">ðŸ‘Ÿ</span>
          <span class="logo-text">Jutta<span class="accent">Pasal</span></span>
        </a>
        <div class="nav-actions">
          <div class="theme-toggle" id="theme-toggle">
            <i class="fas fa-moon" id="theme-icon"></i>
          </div>
        </div>
      </nav>
    </header>

    <main class="main">
      <!-- Checkout Section -->
      <section class="checkout-section">
        <div class="container">
          <div class="checkout-layout">
            <!-- Checkout Form -->
            <div class="checkout-form">
              <!-- Shipping Information -->
              <div class="checkout-step">
                <div class="step-header">
                  <span class="step-number">1</span>
                  <h2>Shipping Information</h2>
                </div>
                <form id="shipping-form">
                  <div class="form-row">
                    <div class="form-group">
                      <label>First Name <span>*</span></label>
                      <input
                        type="text"
                        class="form-control"
                        id="first-name"
                        required
                      />
                    </div>
                    <div class="form-group">
                      <label>Last Name <span>*</span></label>
                      <input
                        type="text"
                        class="form-control"
                        id="last-name"
                        required
                      />
                    </div>
                  </div>
                  <div class="form-group">
                    <label>Email Address <span>*</span></label>
                    <input
                      type="email"
                      class="form-control"
                      id="email"
                      required
                    />
                  </div>
                  <div class="form-group">
                    <label>Phone Number <span>*</span></label>
                    <input
                      type="tel"
                      class="form-control"
                      id="phone"
                      required
                    />
                  </div>
                  <div class="form-group">
                    <label>Street Address <span>*</span></label>
                    <input
                      type="text"
                      class="form-control"
                      id="address"
                      required
                    />
                  </div>
                  <div class="form-row">
                    <div class="form-group">
                      <label>City <span>*</span></label>
                      <input
                        type="text"
                        class="form-control"
                        id="city"
                        required
                      />
                    </div>
                    <div class="form-group">
                      <label>Province <span>*</span></label>
                      <select class="form-control" id="province" required>
                        <option value="">Select Province</option>
                        <option value="province1">Province 1</option>
                        <option value="madhesh">Madhesh</option>
                        <option value="bagmati">Bagmati</option>
                        <option value="gandaki">Gandaki</option>
                        <option value="lumbini">Lumbini</option>
                        <option value="karnali">Karnali</option>
                        <option value="sudurpashchim">Sudurpashchim</option>
                      </select>
                    </div>
                  </div>
                  <div class="form-group">
                    <label>Order Notes (Optional)</label>
                    <textarea
                      class="form-control"
                      id="notes"
                      rows="3"
                      placeholder="Notes about your order, e.g. special notes for delivery"
                    ></textarea>
                  </div>
                </form>
              </div>

              <!-- Shipping Method -->
              <div class="checkout-step">
                <div class="step-header">
                  <span class="step-number">2</span>
                  <h2>Shipping Method</h2>
                </div>
                <div class="shipping-methods">
                  <label class="shipping-method selected">
                    <input
                      type="radio"
                      name="shipping"
                      value="standard"
                      checked
                    />
                    <div class="shipping-info">
                      <h4>Standard Delivery</h4>
                      <p>5-7 business days</p>
                    </div>
                    <span class="shipping-price">Rs. 150</span>
                  </label>
                  <label class="shipping-method">
                    <input type="radio" name="shipping" value="express" />
                    <div class="shipping-info">
                      <h4>Express Delivery</h4>
                      <p>2-3 business days</p>
                    </div>
                    <span class="shipping-price">Rs. 300</span>
                  </label>
                  <label class="shipping-method">
                    <input type="radio" name="shipping" value="sameday" />
                    <div class="shipping-info">
                      <h4>Same Day Delivery</h4>
                      <p>Kathmandu Valley only</p>
                    </div>
                    <span class="shipping-price">Rs. 500</span>
                  </label>
                </div>
              </div>

              <!-- Payment Method -->
              <div class="checkout-step">
                <div class="step-header">
                  <span class="step-number">3</span>
                  <h2>Payment Method</h2>
                </div>
                <div class="payment-methods-checkout">
                  <label class="payment-method selected">
                    <input type="radio" name="payment" value="cod" checked />
                    <div class="payment-method-icon">
                      <i class="fas fa-money-bill-wave"></i>
                    </div>
                    <div class="payment-method-info">
                      <h4>Cash on Delivery</h4>
                      <p>Pay when you receive</p>
                    </div>
                  </label>
                  <label class="payment-method">
                    <input type="radio" name="payment" value="esewa" />
                    <div class="payment-method-icon">
                      <span style="color: #60bb46; font-weight: bold"
                        >eSewa</span
                      >
                    </div>
                    <div class="payment-method-info">
                      <h4>eSewa</h4>
                      <p>Pay with eSewa wallet</p>
                    </div>
                  </label>
                  <label class="payment-method">
                    <input type="radio" name="payment" value="khalti" />
                    <div class="payment-method-icon">
                      <span style="color: #5c2d91; font-weight: bold"
                        >Khalti</span
                      >
                    </div>
                    <div class="payment-method-info">
                      <h4>Khalti</h4>
                      <p>Pay with Khalti wallet</p>
                    </div>
                  </label>
                  <label class="payment-method">
                    <input type="radio" name="payment" value="card" />
                    <div class="payment-method-icon">
                      <img src="img/visa.png" alt="Card" />
                    </div>
                    <div class="payment-method-info">
                      <h4>Credit/Debit Card</h4>
                      <p>Visa, Mastercard</p>
                    </div>
                  </label>
                </div>

                <!-- Card Details (shown when card is selected) -->
                <div class="card-details" id="card-details">
                  <div class="form-group">
                    <label>Card Number</label>
                    <input
                      type="text"
                      class="form-control"
                      placeholder="1234 5678 9012 3456"
                    />
                  </div>
                  <div class="form-row">
                    <div class="form-group">
                      <label>Expiry Date</label>
                      <input
                        type="text"
                        class="form-control"
                        placeholder="MM/YY"
                      />
                    </div>
                    <div class="form-group">
                      <label>CVV</label>
                      <input
                        type="text"
                        class="form-control"
                        placeholder="123"
                      />
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Order Summary -->
            <div class="order-summary">
              <h2>Order Summary</h2>
              <div class="order-items" id="checkout-items">
                <!-- Items loaded dynamically -->
              </div>
              <div class="order-totals">
                <div class="summary-row">
                  <span>Subtotal</span>
                  <span id="checkout-subtotal">Rs. 0</span>
                </div>
                <div class="summary-row">
                  <span>Shipping</span>
                  <span id="checkout-shipping">Rs. 150</span>
                </div>
                <div class="summary-row">
                  <span>Tax (13%)</span>
                  <span id="checkout-tax">Rs. 0</span>
                </div>
                <div class="summary-row total">
                  <span>Total</span>
                  <span id="checkout-total">Rs. 0</span>
                </div>
              </div>
              <button
                class="btn btn-primary place-order-btn"
                id="place-order-btn"
              >
                <i class="fas fa-check"></i> Place Order
              </button>
              <div class="secure-checkout">
                <i class="fas fa-lock"></i>
                <span>Secure checkout powered by SSL</span>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <!-- Toast Container -->
    <div class="toast-container" id="toast-container"></div>

    <script src="js/auth.js"></script>
    <script src="js/cart.js"></script>
    <script src="js/main.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        renderCheckout();

        // Shipping method selection
        document.querySelectorAll(".shipping-method").forEach((method) => {
          method.addEventListener("click", function () {
            document
              .querySelectorAll(".shipping-method")
              .forEach((m) => m.classList.remove("selected"));
            this.classList.add("selected");
            this.querySelector("input").checked = true;
            updateCheckoutTotals();
          });
        });

        // Payment method selection
        document.querySelectorAll(".payment-method").forEach((method) => {
          method.addEventListener("click", function () {
            document
              .querySelectorAll(".payment-method")
              .forEach((m) => m.classList.remove("selected"));
            this.classList.add("selected");
            this.querySelector("input").checked = true;

            // Show/hide card details
            const cardDetails = document.getElementById("card-details");
            if (this.querySelector("input").value === "card") {
              cardDetails.classList.add("active");
            } else {
              cardDetails.classList.remove("active");
            }
          });
        });

        // Place order
        document
          .getElementById("place-order-btn")
          .addEventListener("click", function () {
            // Validate form
            const firstName = document.getElementById("first-name").value;
            const lastName = document.getElementById("last-name").value;
            const email = document.getElementById("email").value;
            const phone = document.getElementById("phone").value;
            const address = document.getElementById("address").value;
            const city = document.getElementById("city").value;

            if (
              !firstName ||
              !lastName ||
              !email ||
              !phone ||
              !address ||
              !city
            ) {
              showToast("Error", "Please fill in all required fields", "error");
              return;
            }

            // Simulate order placement
            showToast("Success", "Order placed successfully!", "success");

            // Clear cart
            localStorage.removeItem("cart");

            // Redirect to success page
            setTimeout(() => {
              alert(
                "Order Placed Successfully!\n\nOrder ID: JP" +
                  Date.now() +
                  "\n\nThank you for shopping with Jutta Pasal!"
              );
              window.location.href = "index.html";
            }, 1000);
          });
      });

      function renderCheckout() {
        const cart = JSON.parse(localStorage.getItem("cart")) || [];
        const container = document.getElementById("checkout-items");

        if (cart.length === 0) {
          window.location.href = "cart.html";
          return;
        }

        container.innerHTML = cart
          .map(
            (item) => `
                <div class="order-item">
                    <div class="order-item-image">
                        <img src="${item.image}" alt="${item.name}">
                    </div>
                    <div class="order-item-info">
                        <h4>${item.name}</h4>
                        <p>Size: ${item.size} | Qty: ${item.quantity}</p>
                    </div>
                    <span class="order-item-price">Rs. ${(
                      item.price * item.quantity
                    ).toLocaleString()}</span>
                </div>
            `
          )
          .join("");

        updateCheckoutTotals();
      }

      function updateCheckoutTotals() {
        const cart = JSON.parse(localStorage.getItem("cart")) || [];
        const subtotal = cart.reduce(
          (sum, item) => sum + item.price * item.quantity,
          0
        );

        const shippingMethod = document.querySelector(
          'input[name="shipping"]:checked'
        ).value;
        let shipping = 150;
        if (shippingMethod === "express") shipping = 300;
        if (shippingMethod === "sameday") shipping = 500;

        const tax = subtotal * 0.13;
        const total = subtotal + shipping + tax;

        document.getElementById(
          "checkout-subtotal"
        ).textContent = `Rs. ${subtotal.toLocaleString()}`;
        document.getElementById(
          "checkout-shipping"
        ).textContent = `Rs. ${shipping.toLocaleString()}`;
        document.getElementById(
          "checkout-tax"
        ).textContent = `Rs. ${tax.toLocaleString()}`;
        document.getElementById(
          "checkout-total"
        ).textContent = `Rs. ${total.toLocaleString()}`;
      }
    </script>
    <script src="js/auth.js"></script>
  </body>
</html>
